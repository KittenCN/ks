
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>性能优化 · CoderFAN 资料库</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="CoderFAN 资料库 各种基础工具使用速查 jest, xss, electron, node, ab, nginx, linux, ssh, docker, vim">
        <meta name="generator" content="GitBook 6.0.3">
        <meta name="author" content="Todd Lyu">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="watch.html" />
    
    
    <link rel="prev" href="electron.html" />
    
    <!-- MathJax 配置：唯一且完整 -->
<script>
    window.MathJax = {
      tex: {
        inlineMath:  [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true,
        processEnvironments: true,
        strict: "ignore",
        macros: { "\\E":"\\mathbb{E}", "\\Var":"\\operatorname{Var}" }
      },
    };
    </script>
    
    <!-- 核心脚本（defer不阻塞渲染） -->
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    
    <!-- 放在 tex-chtml.js 之后 -->
    <script>
    (function () {
      function typeset() {
        if (window.MathJax && MathJax.typesetPromise) {
          MathJax.typesetPromise().catch(console.error);
        }
      }
    
      /* 第一次正文插入 */
      document.addEventListener('DOMContentLoaded', typeset);
    
      /*   关键：等待 gitbook.js 初始化成功   */
      function hookGitBook() {
        if (window.gitbook && gitbook.events) {
          gitbook.events.bind('page.change', typeset);   // 切章排版
        } else {
          /* gitbook.js 还没加载完 → 100 ms 后再试 */
          setTimeout(hookGitBook, 100);
        }
      }
      hookGitBook();   // 启动递归等待
    })();
    </script>
    
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                <a href=".." class="btn"><b></b>&#128512;返回上层&#128512;</b></a>
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    进阶知识
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="structure.html">
            
                <a href="structure.html">
            
                    
                    数据结构与算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="test.html">
            
                <a href="test.html">
            
                    
                    测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="jest.html">
            
                <a href="jest.html">
            
                    
                    Jest
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="xss.html">
            
                <a href="xss.html">
            
                    
                    XSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="electron.html">
            
                <a href="electron.html">
            
                    
                    Electron
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.1.6" data-path="performance.html">
            
                <a href="performance.html">
            
                    
                    性能优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="watch.html">
            
                <a href="watch.html">
            
                    
                    监控
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="node.html">
            
                <a href="node.html">
            
                    
                    Node
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.9" data-path="ab.html">
            
                <a href="ab.html">
            
                    
                    Ab 压测
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.10" data-path="nginx.html">
            
                <a href="nginx.html">
            
                    
                    Nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.11" data-path="linux.html">
            
                <a href="linux.html">
            
                    
                    Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.12" data-path="ssh.html">
            
                <a href="ssh.html">
            
                    
                    SSH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.13" data-path="docker.html">
            
                <a href="docker.html">
            
                    
                    Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.14" data-path="crontab.html">
            
                <a href="crontab.html">
            
                    
                    crontab 定时任务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.15" data-path="vim.html">
            
                <a href="vim.html">
            
                    
                    Vim
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >性能优化</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h2 id="performancetiming">PerformanceTiming</h2>
<p>PerformanceTiming 接口包含了当前页面中与时间相关的信息</p>
<p><strong>初始化页面-&gt;重定向时间, 清除前一个页面 -&gt; 缓存-&gt;DNS 解析-&gt;TCP 三次握手 四次挥手-&gt;向服务器发送请求-&gt;服务器响应返回请求-&gt;处理文件-&gt;加载
的整个流程图</strong></p>
<p><img src="img/chrome/timing-overview.png" alt="preformance"></img></p>
<ol>
<li>navigationStart：当前浏览器窗口的前一个网页关闭，发生 unload 事件时的 Unix 毫秒时间戳。如果没有前一个网页，则等于 fetchStart 属性。</li>
<li>unloadEventStart：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的 unload 事件发生时的 Unix 毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为 0。</li>
<li>unloadEventEnd：如果前一个网页与当前网页属于同一个域名，则返回前一个网页 unload 事件的回调函数结束时的 Unix 毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为 0。</li>
<li>redirectStart：返回第一个 HTTP 跳转开始时的 Unix 毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为 0。</li>
<li>redirectEnd：返回最后一个 HTTP 跳转结束时（即跳转回应的最后一个字节接受完成时）的 Unix 毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为 0。</li>
<li>fetchStart：返回浏览器准备使用 HTTP 请求读取文档时的 Unix 毫秒时间戳。该事件在网页查询本地缓存之前发生。</li>
<li>domainLookupStart：返回域名查询开始时的 Unix 毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于 fetchStart 属性的值。</li>
<li>domainLookupEnd：返回域名查询结束时的 Unix 毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于 fetchStart 属性的值。</li>
<li>connectStart：返回 HTTP 请求开始向服务器发送时的 Unix 毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于 fetchStart 属性的值。</li>
<li>connectEnd：返回浏览器与服务器之间的连接建立时的 Unix 毫秒时间戳。如果建立的是持久连接，则返回值等同于 fetchStart 属性的值。连接建立指的是所有握手和认证过程全部结束。</li>
<li>secureConnectionStart：返回浏览器与服务器开始安全链接的握手时的 Unix 毫秒时间戳。如果当前网页不要求安全连接，则返回 0。</li>
<li>requestStart：返回浏览器向服务器发出 HTTP 请求时（或开始读取本地缓存时）的 Unix 毫秒时间戳。</li>
<li>responseStart：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的 Unix 毫秒时间戳。</li>
<li>responseEnd：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前 HTTP 连接已经关闭，则返回关闭时）的 Unix 毫秒时间戳。</li>
<li>domLoading：返回当前网页 DOM 结构开始解析时（即 Document.readyState 属性变为“loading”、相应的 readystatechange 事件触发时）的 Unix 毫秒时间戳。</li>
<li>domInteractive：返回当前网页 DOM 结构结束解析、开始加载内嵌资源时（即 Document.readyState 属性变为“interactive”、相应的 readystatechange 事件触发时）的 Unix 毫秒时间戳。</li>
<li>domContentLoadedEventStart：返回当前网页 DOMContentLoaded 事件发生时（即 DOM 结构解析完毕、所有脚本开始运行时）的 Unix 毫秒时间戳。</li>
<li>domContentLoadedEventEnd：返回当前网页所有需要执行的脚本执行完成时的 Unix 毫秒时间戳。</li>
<li>domComplete：返回当前网页 DOM 结构生成时（即 Document.readyState 属性变为“complete”，以及相应的 readystatechange 事件发生时）的 Unix 毫秒时间戳。</li>
<li>loadEventStart：返回当前网页 load 事件的回调函数开始时的 Unix 毫秒时间戳。如果该事件还没有发生，返回 0。</li>
<li>loadEventEnd：返回当前网页 load 事件的回调函数运行结束时的 Unix 毫秒时间戳。如果该事件还没有发生，返回 0。</li>
</ol>
<h3 id="常用的计算">常用的计算</h3>
<p><img src="img/prefor/perfor05.png" alt=""></img></p>
<ul>
<li>上个页面的到这个页面的时长 fetchStartfet-navigationStart</li>
<li>重定向时常 ： redirectEnd-redirectStart</li>
<li>DNS 查询耗时 ：domainLookupEnd - domainLookupStart</li>
<li>TCP 链接耗时 ：connectEnd - connectStart</li>
<li>request 请求耗时 ：responseEnd - responseStart</li>
<li>解析 dom 树耗时 ： domComplete - domInteractive</li>
<li>白屏时间 ：responseStart - navigationStart</li>
<li>domready 时间(用户可操作时间节点) ：domContentLoadedEventEnd - navigationStart</li>
<li>onload 时间(总下载时间) ：loadEventEnd - navigationStart</li>
</ul>
<h2 id="preformancenavigation">preformance.navigation</h2>
<p>window.performance.navigation： 旨在告诉开发者当前页面是通过什么方式导航过来的，只有两个属性：type，redirectCount</p>
<p>redirectCount:表示到达最终页面前，重定向的次数，但是这个接口有同源策略限制，即仅能检测同源的重定向。</p>
<p>type:标志页面导航类型,值如下表</p>
<table>
<thead>
<tr>
<th>type 常数</th>
<th style="text-align:center">枚举值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>TYPE_NAVIGATE</td>
<td style="text-align:center">0</td>
<td style="text-align:center">普通进入，包括：点击链接、在地址栏中输入 URL、表单提交、或者通过除下表中 TYPE_RELOAD 和 TYPE_BACK_FORWARD 的方式初始化脚本。</td>
</tr>
<tr>
<td>TYPE_RELOAD</td>
<td style="text-align:center">1</td>
<td style="text-align:center">通过刷新进入，包括：浏览器的刷新按钮、快捷键刷新、location.reload()等方法。</td>
</tr>
<tr>
<td>TYPE_BACK_FORWARD</td>
<td style="text-align:center">2</td>
<td style="text-align:center">通过操作历史记录进入，包括：浏览器的前进后退按钮、快捷键操作、history.forward()、history.back()、history.go(num)。</td>
</tr>
<tr>
<td>TYPE_UNDEFINED</td>
<td style="text-align:center">255</td>
<td style="text-align:center">其他非以上类型的方式进入。</td>
</tr>
</tbody>
</table>
<h2 id="preformancememory">preformance.memory</h2>
<p>window.preformance.memory 描述内存多少，是在 Chrome 中添加的一个非标准属性。</p>
<ol>
<li>jsHeapSizeLimit: 内存大小限制</li>
<li>totalJSHeapSize: 可使用的内存</li>
<li>usedJSHeapSize: JS 对象(包括 V8 引擎内部对象)占用的内存，不能大于 totalJSHeapSize，如果大于，有可能出现了内存泄漏</li>
</ol>
<h4 id="其他的-api">其他的 APi</h4>
<p><img src="img/prefor/perfor02.png" alt=""></img></p>
<ol>
<li>performance.getEntries() 会获取页面加载资源和网络请求信息</li>
<li>performance.getEntriesByType('resource')// 获取资源加载列表</li>
<li>performance.now()是当前时间与 performance.timing.navigationStart 的时间差，以微秒（百万分之一秒）为单位的时间，与 Date.now()-performance.timing.navigationStart 的区别是不受系统程序执行阻塞的影响，因此更加精准。</li>
<li>performance.toJSON() ：它返回一个由 performance 对象各个属性组成的 JSON</li>
<li>PerformanceObserver ： 构造函数使用给定的观察者 callback 生成一个新的 PerformanceObserver 对象.当通过 observe() 方法注册的 条目类型 的 性能条目事件 被记录下来时,调用该观察者回调</li>
</ol>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> PerformanceObserver(list =&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.getEntries()) {
        <span class="hljs-built_in">console</span>.log(entry);
    }
});
<span class="hljs-comment">// Start observing the entry types you care about.</span>
observer.observe({entryTypes: [<span class="hljs-string">'paint'</span>, <span class="hljs-string">'longtask'</span>]});
</code></pre>
<p><img src="img/prefor/perfor04.png" alt=""></img></p>
<p><a href="http://www.cnblogs.com/bldxh/p/6857324.html" target="_blank">链接地址</a></p>
<h3 id="注意">注意</h3>
<p>目前主流浏览器虽然都已支持 Performance 对象，但是并不能支持它上面的全部属性和方法，本文主要依据 chrome 编写，因此提到的 chrome 浏览器都是兼容的，其他具体使用时兼容性请自行测试，目前已测如下：</p>
<ol>
<li>safari 浏览器(包括 mac 和 ios)只支持 navigation,timing,now 其余均不支持</li>
<li>微信浏览器支持 timing,navigation 属性，不支持 performance.getEntries 方法</li>
</ol>
<h2 id="sumary-chrome-浏览器">Sumary chrome 浏览器</h2>
<p>总览堆栈的统计信息。可以清楚的看出堆快照的分布情况。</p>
<p><img src="img/chrome/img1.png" alt="chrome"></img></p>
<ol>
<li>蓝色:网络通信</li>
<li>黄色:javascript 执行</li>
<li>紫色:样式计算 重排</li>
<li>绿色:重绘</li>
</ol>
<h3 id="浏览器性能优化工具">浏览器性能优化工具</h3>
<ol>
<li>pagespeed （chrome 插件）</li>
<li>performance-bookmarklet （chrome 插件）</li>
<li>Make the web faster （chrome 插件）</li>
<li>preformance(profiles 旧版)</li>
<li>性能魔方(第三方网站)</li>
</ol>
<h3 id="关键指标">关键指标</h3>
<p>ttfp:返回的第一个字节
fp:页面的反应，第一个像素点落地 background:#ddd;看的见
fcp: 第一个有意义的内容 0-2s 之内
fmp：有意义的绘制 （自定义的）
DCL：
lcp:0——2.5s。第一个绘制的最大内容
longTask: 长任务时间
tti:--3.8s. 可交互</p>
<h3 id="性能优化">性能优化</h3>
<ol>
<li>前端性能优化:小字为先， 埋点测速，</li>
<li>雅虎军规</li>
<li>简化页面标签, 减少重排 重绘</li>
<li>精简 css uncss( 去除无用的 css)</li>
<li>精简 js 代码 巧用数据结构与算法</li>
<li>打包压缩合并 tree-shaking</li>
<li>开启 cnd 预解析 prefetch</li>
<li>开启 cnd 加速(并行最多 5 个)。节约 cookie 带宽 节约主域名的连接数，优化页面响应速度</li>
<li>开启页面懒加载</li>
<li>缓存静态资源文件 localstrage</li>
</ol>
<h3 id="性能优化调试指标">性能优化调试指标</h3>
<h4 id="webpagetest-本地服务">webPageTest 本地服务</h4>
<pre><code class="lang-shell">  本地部署 webPageTest 测试

            docker
                docker pull webpagetest/server
                docker pull webpagetest/agent
</code></pre>
<h4 id="lighthourse">lighthourse</h4>
<pre><code class="lang-shell">npm install lighthourse  -g
</code></pre>
<h2 id="性能守卫平台">性能守卫平台</h2>
<p>通过收集 FP、FCP、TTi、LCP、FMP 等参数，监控线上项目运行状态</p>
<p><img src="img/prefor/liucheng.png" alt="chrome"></img></p>
<h3 id="影响不确定性因素">影响不确定性因素</h3>
<ol>
<li>页面不确定性</li>
<li>用户侧网络情况</li>
<li>终端设备</li>
<li>页面服务</li>
</ol>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="electron.html" class="navigation navigation-prev " aria-label="Previous page: Electron">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="watch.html" class="navigation navigation-next " aria-label="Next page: 监控">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"description":"CoderFAN 资料库 各种基础工具使用速查 jest, xss, electron, node, ab, nginx, linux, ssh, docker, vim","title":"性能优化","level":"1.1.6","depth":2,"next":{"title":"监控","level":"1.1.7","depth":2,"path":"watch.md","ref":"watch.md","articles":[]},"previous":{"title":"Electron","level":"1.1.5","depth":2,"path":"electron.md","ref":"electron.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-search","-livereload","-lunr","-fontsettings","highlight","expandable-chapters-small","back-to-top-button","github","code","theme-default"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{"lang":{"eval_rst":"rst","toc":"text"}},"github":{"url":"https://github.com/KittenCN"},"expandable-chapters-small":{},"back-to-top-button":{},"code":{"copyButtons":true},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Todd Lyu","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"CoderFAN 资料库","gitbook":"*","description":"CoderFAN 资料库 各种基础工具使用速查 jest, xss, electron, node, ab, nginx, linux, ssh, docker, vim"},"file":{"path":"performance.md","mtime":"2025-05-12T03:21:13.095Z","type":"markdown"},"gitbook":{"version":"6.0.3","time":"2025-05-12T03:28:06.300Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-code/plugin.js"></script>
        
    

    </body>
</html>

