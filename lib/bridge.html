<html>
<head lang="zh-cmn-Hans">
    <meta charset="UTF-8">
    <title>
        DSBridge Test
    </title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=0.5,user-scalable=no">
<!--    require dsbridge init js-->
<script src="https://cdn.bootcdn.net/ajax/libs/dsbridge/3.1.4/dsbridge.min.js"></script>
        <!-- <script src="https://unpkg.com/dsbridge/dist/dsbridge.js" type="text/javascript"></script> -->
<!--    <script>-->
<!--        var bridge={default:this,call:function(b,a,c){var e="";"function"==typeof a&&(c=a,a={});a={data:void 0===a?null:a};if("function"==typeof c){var g="dscb"+window.dscb++;window[g]=c;a._dscbstub=g}a=JSON.stringify(a);if(window._dsbridge)e=_dsbridge.call(b,a);else if(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))e=prompt("_dsbridge="+b,a);return JSON.parse(e||"{}").data},register:function(b,a,c){c=c?window._dsaf:window._dsf;window._dsInit||(window._dsInit=!0,setTimeout(function(){bridge.call("_dsb.dsinit")},-->
<!--                0));"object"==typeof a?c._obs[b]=a:c[b]=a},registerAsyn:function(b,a){this.register(b,a,!0)},hasNativeMethod:function(b,a){return this.call("_dsb.hasNativeMethod",{name:b,type:a||"all"})},disableJavascriptDialogBlock:function(b){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==b})}};-->
<!--        !function(){if(!window._dsf){var b={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,dsBridge:bridge,close:function(){bridge.call("_dsb.closePage")},_handleMessageFromNative:function(a){var e=JSON.parse(a.data),b={id:a.callbackId,complete:!0},c=this._dsf[a.method],d=this._dsaf[a.method],h=function(a,c){b.data=a.apply(c,e);bridge.call("_dsb.returnValue",b)},k=function(a,c){e.push(function(a,c){b.data=a;b.complete=!1!==c;bridge.call("_dsb.returnValue",b)});a.apply(c,e)};if(c)h(c,this._dsf);else if(d)k(d,this._dsaf);-->
<!--            else if(c=a.method.split("."),!(2>c.length)){a=c.pop();var c=c.join("."),d=this._dsf._obs,d=d[c]||{},f=d[a];f&&"function"==typeof f?h(f,d):(d=this._dsaf._obs,d=d[c]||{},(f=d[a])&&"function"==typeof f&&k(f,d))}}},a;for(a in b)window[a]=b[a];bridge.register("_hasJavascriptMethod",function(a,b){b=a.split(".");if(2>b.length)return!(!_dsf[b]&&!_dsaf[b]);a=b.pop();b=b.join(".");return(b=_dsf._obs[b]||_dsaf._obs[b])&&!!b[a]})}}();-->
<!--    </script>-->
    <style type="text/css">
        .btn {
            text-align: center;
            background: #eee;
            color: #000;
            padding: 20px;
            margin: 30px;
            font-size: 24px;
            border-radius: 4px;
            box-shadow: 4px 2px 10px #999;
        }

        .btn:active {
            opacity: .7;
            box-shadow: 4px 2px 10px #555;
        }

        .input {
            height: 50px;
            width: 300px;
            padding: 20px;
            margin: 30px;
            adjust-position:”false”;
        }

    </style>
</head>
<body>
<h1>jsbrider</h1>
<!-- <div class="btn" onclick="makeCall()">
    makeCall
</div>
<div class="btn" onclick="showLoading()">
    showLoading
</div>
<div class="btn" onclick="hideLoading()">
    hideLoading
</div> -->

<!-- <a href="javascript:history.go(-1);">返回上一页</a> -->

<div class="btn" onclick="setCopyText()">
    setCopyText
</div>
<div class="btn" onclick="isShowPullRefresh1()">
    isShowPullRefresh 1
</div>
<div class="btn" onclick="isShowPullRefresh0()">
    isShowPullRefresh 0
</div>
<div class="btn" onclick="controlBack0()">
    controlBack 0 原生自己控制返回
</div>
<div class="btn" onclick="controlBack1()">
    controlBack 1 h5控制返回
</div>
<div class="btn" onclick="showToast()">
    showToast
</div>
<div class="btn" onclick="getLocation()">
    getLocation
</div>
<div class="btn" onclick="openExternalBrowser()">
    openExternalBrowser
</div>
<div class="btn" onclick="debugLog()">
    debugLog
</div>
<div class="btn" onclick="headerSetOption()">
    headerSetOption 1
</div>
<div class="btn" onclick="headerSetOption2222()">
    headerSetOption Right
</div>
<div class="btn" onclick="headerSetOptionHide()">
    headerSetOption Hide
</div>
<div class="btn" onclick="headerSetOptionShowAndColor()">
    headerSetOption Show and set color
</div>
<div class="btn" onclick="getUserInfo()">
    getUserInfo
</div>
<div class="btn" onclick="getOSInfo()">
    getOSInfo
</div>
<div class="btn" onclick="closePage()">
    close page
</div>
<div class="btn" onclick="getAppInfo()">
    getAppInfo
</div>
<div class="btn" onclick="openURL()">
    openURL nio.com
</div>
<div class="btn" onclick="openURL1()">
    openURL 自己
</div>
<div class="btn" onclick="setStorageValue()">
    setStorageValue
</div>
<div class="btn" onclick="getStorageValue()">
    getStorageValue
</div>
<div class="btn" onclick="removeStorage()">
    removeStorage
</div>
<div class="btn" onclick="clearStorage()">
    clearStorage
</div>
<div class="btn" onclick="getCurrentPageInfo()">
    getCurrentPageInfo
</div>

<!--<input type="text" onblur="inputOver()" class="input">-->

<div class="btn" onclick="showInputEdit()">
    showInputEdit navite
</div>

<div class="btn" onclick="goBack()">
    goBack 2 page（一次回退两个页面）
</div>

<div class="btn" onclick="goBack()">
    goBack 2 page
</div>
<div class="btn" onclick="postNotificationFromHtmlToNative()">
    postNotificationFromHtmlToNative
</div>
<div class="btn" onclick="openMap()">
    open Map
</div>
<div class="btn" onclick="isNotificationEnabled()">
    isNotificationEnabled
</div>
<div class="btn" onclick="goToSetNotification()">
    goToSetNotification
</div>
<div class="btn" onclick="getShareData()">
    getShareData
</div>
<div class="btn" onclick="openPreviewImage()">
    openPreviewImage
</div>
<div class="btn" onclick="share()">
    share
</div>
<div class="btn" onclick="postUGC()">
    postUGC
</div>
<div class="btn" onclick="getCurrencyFormat()">
    getCurrencyFormat
</div>
<div class="btn" onclick="getNumberFormat()">
    getNumberFormat
</div>

<div class="btn" onclick="openPdf()">
    openPdf
</div>
<div class="btn" onclick="showConfirm()">
    show confirm

</div>
<form>

    <script src="https://libs.baidu.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="//cdn-app.nio.com/pe/vconsole3.3.4.min.js"></script>
    <script type="text/javascript">
      var vConsole = new window.VConsole();
        window.onload =function(){
            <!--dsBridge.call("common.controlSwipeRefresh", "0")-->

        }

        //下拉刷新监听
        dsBridge.register('ON_PULL_REFRESH', function (responseCallback) {
            showResult("get it !!!")
            return false;
        })

        dsBridge.register('ON_PRESS_BACK',function(responseCallback){
            showResult("get it back!!!")
            // 按下返回键后的操作
            return false
        })

        //网络状态监听
        dsBridge.register('ON_NET_WORK_CHANGE',function(l){
            showResult("ON_NET_WORK_CHANGE：" + JSON.stringify(l))
        })

        //appear
        dsBridge.register('ON_APPEAR',function(l){
            showResult("ON_APPEAR：" + JSON.stringify(l))
        })

        //键盘监听
        dsBridge.register('ON_KEYBOARD_STATE_CHANGE',function(l){
            showResult("ON_KEYBOARD_STATE_CHANGE：" + JSON.stringify(l))
        })

        //监听本地写一个view的一个回调 评论的demo 特例
        dsBridge.register('ON_INPUT_KEYBROAD_CHANGE',function(l){
            showResult("ON_INPUT_KEYBROAD_CHANGE：bottom = " + JSON.stringify(l))
        })

        //自定义的回调 函数名是后面代码传进去的
        dsBridge.register('onTitle',function(l){
            showResult("自定义的回调")
        })

        //位置变化
        dsBridge.register('locationUpdate',function(l){
            showResult("locationUpdate：" + JSON.stringify(l))
        })

        function showResult(str){
            dsBridge.call("showToast", str)
        }

        function makeCall(){
            dsBridge.call("makeCall", "400-999-6699")
        }
        function showLoading(){
            dsBridge.call("showLoading", "")
        }
        function hideLoading(){
            dsBridge.call("hideLoading", "")
        }
        function setCopyText(){
            dsBridge.call("setCopyText", "fdsfasfsfsdfsdfs")
        }
        function isShowPullRefresh1(){
            dsBridge.call("isShowPullRefresh", "1")
        }
        function isShowPullRefresh0(){
            dsBridge.call("isShowPullRefresh", "0")
        }

        function controlBack1(){
            var info = dsBridge.call('getCurrentPageInfo', '');
            var keystr = info.data.objectId + "_ON_PRESS_BACK";
            dsBridge.call("setStorageValue", {key:keystr,value:{preventDefault:1},expire:new Date().getTime() + 1000000})
        }

        function controlBack0(){
            var info = dsBridge.call('getCurrentPageInfo', '');
            var keystr = info.data.objectId + "_ON_PRESS_BACK";
            dsBridge.call("setStorageValue", {key:keystr,value:{preventDefault:0},expire:new Date().getTime() + 1000000})
        }

        function showToast(){
            dsBridge.call("showToast", {content:"woshi toast",duration:1})
        }

        function getLocation(){
             console.log('getLocation');
            dsBridge.call("getLocation", "",function(string){
                console.log('getLocation',string)
                alert(JSON.stringify(string))
            })
        }

        function openExternalBrowser(){
            dsBridge.call("openExternalBrowser", "https://www.baidu.com")
        }

        function debugLog(){
            dsBridge.call("debugLog", " I am log ")
        }

        function headerSetOption() {
            dsBridge.call("headerSetOption", {
                // 标题 图标型标题
                title:{
                    // 标题内容
                    text: null,
                    textColor: "AAAAAA",
                    // 图标
                    icon:{
                        // 图标位置 在文字前还是文字后
                        position:"left", // left right
                        //
                        url: "https://www.kavo.co.jp/wp-content/themes/twentyeleven3/image/icon_facebook.jpg"
                    },
                    callback: "onTitle"
                },

                // 左侧栏
                leftColumn: [{
                    text: "标题",
                    textColor: "AAAAAA",
                    icon:null,
                    callback:"onCustom"
                },{
                    text:"",
                    icon:{
                        position:"left", // left right
                        url:"https://www.kavo.co.jp/wp-content/themes/twentyeleven3/image/icon_facebook.jpg"
                    },
                    callback:"onCustom"
                }],
                // 右侧栏
                rightColumn: null
            })
        }

        function headerSetOption2222() {
            dsBridge.call("headerSetOption", {
                // 标题
                title:{
                    // 标题内容
                    text: "标题xx",
                    textColor: "AA00AA",
                    // 图标
                    icon:{
                        // 图标位置 在文字前还是文字后
                        position:"left", // left right
                        //
                        url: null
                    },
                    callback: "onTitle"
                },

                // 右侧栏
                rightColumn: [{
                    text: "标题右1",
                    textColor: "AAAAAA",
                    icon:{
                        position:"left", // left right
                        url:"https://www.kavo.co.jp/wp-content/themes/twentyeleven3/image/icon_facebook.jpg"
                    },
                    callback:"onCustom"
                },{
                    text: "标题右2",
                    textColor: "AAAAAA",
                    icon:{
                        position:"right", // left right
                        url:"https://www.kavo.co.jp/wp-content/themes/twentyeleven3/image/icon_facebook.jpg"
                    },
                    callback:"onCustom"
                }]
            })
        }

        function headerSetOptionHide() {
            dsBridge.call("headerSetOption", {
                isShow:false
            })
        }

        function headerSetOptionShowAndColor() {
            dsBridge.call("headerSetOption", {
                isShow:true,
                color:"AA00AA",
                // 标题
                title:{
                    // 标题内容
                    text: "标题xx",
                    textColor: "AA00AA",
                    // 图标
                    icon:{
                        // 图标位置 在文字前还是文字后
                        position:"left", // left right
                        //
                        url: null
                    },
                    callback: "onTitle"
                },

                // 右侧栏
                rightColumn: [{
                    text: "标题右1",
                    textColor: "AAAAAA",
                    icon:{
                        position:"left", // left right
                        url:"https://www.kavo.co.jp/wp-content/themes/twentyeleven3/image/icon_facebook.jpg"
                    },
                    callback:"onCustom"
                },{
                    text: "标题右2",
                    textColor: "AAAAAA",
                    icon:{
                        position:"right", // left right
                        url:"https://www.kavo.co.jp/wp-content/themes/twentyeleven3/image/icon_facebook.jpg"
                    },
                    callback:"onCustom"
                }]
            })
        }

        function getUserInfo(){
            console.log(dsBridge.call("getUserInfo", ""))
            alert(JSON.stringify(dsBridge.call("getUserInfo", "")))
        }

        function getOSInfo(){
            alert(JSON.stringify(dsBridge.call("getOSInfo", "")))
        }

        function closePage(){
            dsBridge.call("close", "")
        }

        function getAppInfo(){
            alert(JSON.stringify(dsBridge.call("getAppInfo", "")))
        }

        function openURL(){
            dsBridge.call("openURL", "https://www.nio.cn",function(string){

            })
        }

        function openURL1(){
            dsBridge.call("openURL", "file:///android_asset/demo/dist/testnew.html?isShow=true",function(string){

            })
        }

        dsBridge.register('ON_NET_WORK_CHANGE',function(l){
            alert(JSON.stringify(l))
        })

        function setStorageValue(){
            dsBridge.call("setStorageValue", {key:'Key1',value:'I am data',expire:new Date().getTime() + 100000})
        }

        function getStorageValue(){
            alert(JSON.stringify(dsBridge.call("getStorageValue", "Key1")))
        }

        function removeStorage(){
            dsBridge.call("removeStorage", "Key1")
        }

        function clearStorage(){
            dsBridge.call("clearStorage","")
        }

        function getCurrentPageInfo(){
            alert(JSON.stringify(dsBridge.call("getCurrentPageInfo","")))
        }

        function showInputEdit(){
            dsBridge.call("showInputEdit",{content:"默认内容",length:11},function(string){
                 dsBridge.call("showToast", JSON.stringify(string))
            })
        }

        function goBack(){
            dsBridge.call("goBack",2)
        }

        function postNotificationFromHtmlToNative(){
            var data = {
                key: "action_name",
                data: {
                      name: "woshiname",
                      id: "id"
                }
            }
            dsBridge.call("postNotificationFromHtmlToNative", data)
        }

        function openMap(){
            dsBridge.call("openMap",{"latitude":"31.281617609813139","longitude":"121.19208673026523"})
        }

        function isNotificationEnabled(){
            dsBridge.call("isNotificationEnabled",function(string){
                 dsBridge.call("showToast", JSON.stringify(string))
            })
        }
        function goToSetNotification(){
            dsBridge.call("goToSetNotification","")
        }

        function getShareData(){
            alert(JSON.stringify(dsBridge.call("getStorageValue", "sharedata")))
        }

        function openPreviewImage(){
            var arg = {
              "urls": ["https://static.macflow.net/wp-content/uploads/2018/03/kantu.jpg",
                       "https://img.iplaysoft.com/wp-content/uploads/2017/unsplash/unsplash_image.jpg"
                      ],
              "position": 1
            }
            dsBridge.call("previewPhoto",arg)
        }

        function share(){
            var arg = {
              "title": "I am title",
              "subTitle": "我是sub title",
              "imgUrl":"https://www.nio.cn/cdn-static/mynio/images/about/about-hero-desktop.jpg",
              "url":"https://l.nio.com/s/qGdSNjWRi4",
              "type":["facebook","messenger","twitter","copy_link","system_more"]
            }
            dsBridge.call("share",arg,function(data){
                        alert(data);
                    })
        }

        function postUGC(){
            var arg = {
              "content": "I am title",
              "imgUrls":["https://www.nio.cn/cdn-static/mynio/images/about/about-hero-desktop.jpg"]
            }
            dsBridge.call("postUGC",arg,function(data){
                        alert(data);
                    })
        }

       function getCurrencyFormat(){
            var arg = {
              "currency_code": "NOK",
              "price":123456.889,
              "minimumFractionDigits":2,
              "maximumFractionDigits":2,
              "local":"zh_CN"
            }
            var result = dsBridge.call("getCurrencyFormat",arg)
            alert(JSON.stringify(result))
        }

        function getNumberFormat(){
            var arg = {
              "number":123456.889,
              "minimumFractionDigits":0,
              "maximumFractionDigits":0,
              "local":"zh_CN"
            }
            var result = dsBridge.call("getNumberFormat",arg)
            alert(JSON.stringify(result))
        }


        function openPdf(){
            dsBridge.call("openPdf","https://cdn-app-test.eu.nio.com/mer/2021/08/31/d74716f0-f904-4b1a-a9e5-12798fe1f521.pdf",function(data){
                        alert(data);
                    })
        }

         function showConfirm(){
            var arg =  {
                  "title": "title",
                  "content": "content 是我",
                  "buttons": [
                         {  "title": "取消", "type": "cancel" } ,
                         {  "title": "确定", "type": "yes" }
                   ]
              }
            var result = dsBridge.call("confirm",arg,function(s){
                alert(JSON.stringify(s))
            })
        }

    </script>
</form>
</body>
</html>
